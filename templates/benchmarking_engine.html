
{%extends 'base.html'%}

{% block title %}Benchmarking Engine{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

            <!-- Hero Image and Title -->
            <div class="hero-body">
                <div class="container" style=" margin-top: 5vh;">
    
                        <!-- Landing page Title -->
                            <h1 class="title is-1  is-light is-semibold has-text-centered is-spaced">Blockchain Benchmarking Framework </h1>
                            
                  </div>
            </div>
            <div class="divider is-spaced is-centered is-large"> </div>
        </section>
    
        <section class="section" >
            <div class="container">
              <div class="column is-5">

     
                
                  <!-- Content wrapper -->
                  <div class="content-wrapper is-large">
                    <div class="columns is-vcentered">
                        <!-- Feature -->
                        <div class="column is-9">
                            <div class="feature">
                              <a id="slideSteps" class="button k-button k-secondary is-bold raised has-gradient is-fat ">
                                <span class="text">Configure a Network</span>
                                <span class="front-gradient"></span>
                            </a>
                            </div>
                            <div class="w3-container">
                                <div id="id01" class="w3-modal">
                                  <div class="w3-modal-content w3-card-4 w3-animate-zoom" style="max-width:600px">
                                    <div class="w3-container w3-black">
                                      <h2 class="title is-light is-2 is-semibold has-text-centered ">Please start the Monitoring Engine before configure a network</h2>
                                      <h4 class="title is-light is-4 is-semibold has-text-centered ">This is required only once</h4>
                                              <div class=" has-text-centered ">
                                              <a id="start_monitoring" style="margin-left:0.1vw;"  class="button k-button k-secondary raised has-gradient is-fat is-bold" onclick="document.getElementById('id01').style.display='none'">
                                                <span class="text">Start Monitoring</span>
                                                <span class="front-gradient"></span>
                                            </a>
                                            </div>
                                      </div>
                                  </div>
                            </div>
                          </div>
                        </div>
                        <!-- Feature -->
                        <div class="column is-10">
                            <div class="feature">
                              <a href="/swagger" class="button k-button k-primary raised has-gradient is-bold is-fat">
                                <span class="text">VIEW API</span>
                                <span class="front-gradient"></span>
                            </a>
                            </div>
                        </div>
                        <!-- Feature -->
                        <div class="column is-10">
                            <div class="feature">
                              <a href="{{url_for("management")}}" class="button k-button k-primary raised has-gradient is-bold is-fat ">
                                <span class="text">Management</span>
                                <span class="front-gradient"></span>
                            </a>
                            </div>
                        </div>
                    </div>
    
                
                </div>
                <!-- Content wrapper -->
              </div>
              <div id="steps" class="container" >
              <div class="divider  is-centered"> </div>
                <h2 class="title is-light is-semibold has-text-centered is-spaced">5 Steps to Success </h2>
                <!-- Flying tabs wrapper -->
              <div  class="flying-wrapper">
                <!-- Tabs container -->
                <div class="steps-container">
                    <!-- Tabs -->
                    
                    <div class="steps" style="display:grid!important;">
                        
                        <div id="multi-step-form-container">
                            <!-- Form Steps / Progress Bar -->
                            <ul class="form-stepper form-stepper-horizontal text-center mx-auto pl-0">
                                <!-- Step 1 -->
                                <li class="form-stepper-active text-center form-stepper-list" step="1">
                                    <a class="mx-2">
                                        <span class="form-stepper-circle">
                                            <span>1</span>
                                        </span>
                                        <div class="label">Deploy Network</div>
                                    </a>
                                </li>
                                <!-- Step 2 -->
                                <li class="form-stepper-unfinished text-center form-stepper-list" step="2">
                                    <a class="mx-2">
                                        <span class="form-stepper-circle text-mutedd">
                                            <span>2</span>
                                        </span>
                                        <div class="label text-mutedd">Start a Network</div>
                                    </a>
                                </li>
                              </ul>
                            <!-- Step Wise Form Content -->
                                <!-- Step 1 Content -->
                                <section id="step-1" class="form-step">
                                    <h2 class="title is-light is-2 is-semibold has-text-centered ">Fill the fields to Start a Network</h2>
                                    <!-- Step 1 input fields -->
                                    <div class="container steps"  >
                                      <form id="userAccountSetupForm" name="userAccountSetupForm" enctype="multipart/form-data" method="post">

                                    <div class="columns is-vcentered">
                                        <div class="column is-3">
                                          <div class="archives-widget">
                                              <select id="selected" class="select is-small" style="background-color:transparent; color:white; font-size:16px;">
                                                <option id="opt1" class="option">Select a Network</option>
                                                  {% for i in li%}
                                                <option name='{{i}}' id="opt-{{i}}" class="option">{{i}}</option>
                                                  {%endfor%}
                                                </select>
                                        </div>
                                      </div>
                                          <div class="column is-4" style="padding-left:3vw; margin-bottom:-4vh;">
                                            <!-- Form -->
                                            <div class="column is-6">
                                                <div class="control-material is-secondary">      
                                                <input id="num_of_nodes" class="material-input " type="number" min="1" oninput="validity.valid||(value='');" required>
                                                <span class="material-highlight"></span>
                                                <span class="bar"></span>
                                                <label>Num of Nodes</label>
                                            </div>
                                          </div>
                                          </div>
                                          <div class="column is-3">
                                            <button id="btn1" class="button k-button is-primary is-fat rounded" > Configure! </button>
                                        </div>
                                      </form>
                                      <div class="column is-3">
                                        <div class="mt-3" id="mt-3">
                                          <h4 id="wait1" class="title hidden title is-5  is-light"> Wait till process finish.... </h4>

                                          <button id="to-step-2" name="configure_" class="button k-button k-primary rounded raised has-gradient  front-gradient   is-bold btn-navigate-form-step hidden" type="button" step_number="2">Start Network</button>
                                      </div>
                                      </div>
                                      
                                  </div>
                                </div>
                                </section>
                                <!-- Step 2 Content, default hidden on page load. -->
                                <section id="step-2" class="form-step d-none">
                                  <h2 class="title is-light is-2 is-semibold has-text-centered ">Fill the fields to Start a Network</h2>
                                  <!-- Step 1 input fields -->
                                  <div class="container steps">
                                  <div class="columns is-vcentered">
                                        <div class="column is-2">
                                          <figure class="media is-white">
                                            <div class="accepted-currencies">
                                            <i id="icon1" class="cf cf-eth"></i>
                                            </div>
                                          </figure>
                                        </div>
                                          <div class="column is-4" style=" margin-bottom:-4vh; width:20%;">
                                            <!-- Form -->
                                                <form class="form" >                                          
                                                      <div class="control-material is-secondary">      
                                                        <input id="num_of_nodes2" class="material-input " type="number" min="1" oninput="validity.valid||(value='');" required>
                                                        <span class="material-highlight"></span>
                                                        <span class="bar"></span>
                                                        <label>Num of Nodes</label>
                                                    </div>
                                          </div>
                                        <div class="column is-3" style="margin-left:8vw;">
                                          <button id="btn2" name="start_" class="button k-button is-primary is-fat rounded">   Start! </button>
                                        </div>
                                         </form>
                                        <div class="column is-3">
                                          <div class="mt-3" id="mt-3">
                                            <h4 id="wait2"  class="title is-5 has-text-center  is-light hidden"> Wait till process finish.... </h4>
                                            <button class="button k-button k-primary rounded raised has-gradient  front-gradient   is-bold btn-navigate-form-step" type="button" step_number="1">Deploy Another Network</button>
                                        </div>
                                    </div>
                                    
                                </div>
                                </section>
                                <!-- 
                                
                                <section id="step-4" class="form-step d-none">
                                  <h2 class="title is-light is-2 is-semibold has-text-centered ">Fill the fields to Start a Network</h2>
                                 Step 1 input fields 
                                  <div class="container steps" >
                                    <div class="columns is-vcentered ">
                                          <div class="column is-2">
                                            <figure class="media is-white">
                                              <div class="accepted-currencies">
                                              <i class="cf cf-eth"></i>
                                              </div>
                                            </figure>
                                          </div>
                                            <div class="column is-5" style=" margin-bottom:-4vh; width:20%;">
                                              
                                                  <form class="form" method="post" >                                          
                                                        <div class="control-material is-secondary">      
                                                          <input class="material-input " type="number" min="1" oninput="validity.valid||(value='');" required>
                                                          <span class="material-highlight"></span>
                                                          <span class="bar"></span>
                                                          <label>Num of Accounts</label>
                                                      </div>
                                                    </div>
                                                    <div class="column is-5" style=" margin-bottom:-4vh; width:20%;">

                                                      <div class="control-material is-secondary">      
                                                        <input class="material-input " type="number" min="1" oninput="validity.valid||(value='');" required>
                                                        <span class="material-highlight"></span>
                                                        <span class="bar"></span>
                                                        <label>Num of Txs</label>
                                                    </div>
                                                  </div>
                                          <div class="column is-3" style="margin-left:4vw;">
                                            <button class="button k-button is-primary is-fat rounded"> Start Traffic Generator! </button>
                                          </div>
                                          </form>
                                          <div class="column is-3">
                                            <div class="mt-3" id="mt-3">
                                              <button class="button k-button k-primary rounded raised has-gradient  front-gradient   is-bold btn-navigate-form-step" type="button" step_number="5">Done</button>
                                          </div>
                                    
                                      </div>
                              </div>
                              </section> -->
                            
                        </div>
                    </div>
    
                </div>
              </div>
            </div>
        </section>

        <section id="array"  class="section hidden" style="margin-top:0; padding-top:0; ">
            <div class="container">
              <div class="b-table">
                <div class="table-wrapper has-mobile-cards">
                  <table id="myTable" class="table is-fullwidth is-hoverable is-fullwidth">
                    <thead>
                    <tr>
                      <th class="is-chevron-cell"></th>
                      <th></th>
                      <th>Network name</th>
                      <th>Network status</th>
                      <th>Actions</th>
                      <th>Traffic Generation</th>
                    </tr>
                    </thead>
                    <tbody>
                      
                        <tr>
                          <div class="content" id="wrapper" style="display:hidden;">
                            <td colspan="8">
                              <div class="detail-container" style="display:none;">
                                <article class="media">
                                  <figure class="media-left">
                                    <i class="cf cf-eth"></i>
                                  </figure>
                                  <div class="media-content">
                                    <div class="detail">
                                      <p>
                                        Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                                        Proin ornare magna eros, eu pellentesque tortor vestibulum ut.
                                        Maecenas non massa sem. Etiam finibus odio quis feugiat facilisis.
                                      </p>
                                    </div>
                                  </div>
                                </article>
                              </div>
                            </td>
                        </div>
                        </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </section> 
    </div>

<script>
    /**
 * Define a function to navigate betweens form steps.
 * It accepts one parameter. That is - step number.
 */
const navigateToFormStep = (stepNumber) => {
    /**
     * Hide all form steps.
     */
    document.querySelectorAll(".form-step").forEach((formStepElement) => {
        formStepElement.classList.add("d-none");
    });
    /**
     * Mark all form steps as unfinished.
     */
    document.querySelectorAll(".form-stepper-list").forEach((formStepHeader) => {
        formStepHeader.classList.add("form-stepper-unfinished");
        formStepHeader.classList.remove("form-stepper-active", "form-stepper-completed");
    });
    /**
     * Show the current form step (as passed to the function).
     */
    document.querySelector("#step-" + stepNumber).classList.remove("d-none");
    /**
     * Select the form step circle (progress bar).
     */
    const formStepCircle = document.querySelector('li[step="' + stepNumber + '"]');
    /**
     * Mark the current form step as active.
     */
    formStepCircle.classList.remove("form-stepper-unfinished", "form-stepper-completed");
    formStepCircle.classList.add("form-stepper-active");
    /**
     * Loop through each form step circles.
     * This loop will continue up to the current step number.
     * Example: If the current step is 3,
     * then the loop will perform operations for step 1 and 2.
     */
    for (let index = 0; index < stepNumber; index++) {
        /**
         * Select the form step circle (progress bar).
         */
        const formStepCircle = document.querySelector('li[step="' + index + '"]');
        /**
         * Check if the element exist. If yes, then proceed.
         */
        if (formStepCircle) {
            /**
             * Mark the form step as completed.
             */
            formStepCircle.classList.remove("form-stepper-unfinished", "form-stepper-active");
            formStepCircle.classList.add("form-stepper-completed");
        }
    }
};
/**
 * Select all form navigation buttons, and loop through them.
 */
document.querySelectorAll(".btn-navigate-form-step").forEach((formNavigationBtn) => {
    /**
     * Add a click event listener to the button.
     */
    formNavigationBtn.addEventListener("click", () => {
        /**
         * Get the value of the step.
         */
        const stepNumber = parseInt(formNavigationBtn.getAttribute("step_number"));
        /**
         * Call the function to navigate to the target form step.
         */
        navigateToFormStep(stepNumber);
    });
});
</script>


<script>
  function toggles(network){
    $(`#startstop${network}`).toggleClass('is-success is-danger')
    $(`#clean${network}`).toggleClass('appear hidden')
    $(`#stopstopicon${network}`).toggleClass('mdi-arrow-right-drop-circle mdi-trash-can')
    

  };

  function something(network){
    view();
  };


  function view(network){
    $(".detail-container").slideToggle("slow");
    $("#icon").toggleClass(' is-expanded')
  };

  $("#slideSteps").click(function(){
    fetch('/docker/management/is_monitoring_configured')
    .then((response) => response.json())
    .then(function(data) {
      if(data == "True") {
        $("#steps").slideToggle("slow");
      }
      else{
        document.getElementById('id01').style.display='block'
      };
   
    });
  });


</script>
<script type="text/javascript">
  $("#start_monitoring").click(function(){
    fetch('/request/mon')
    .then((response) => response.json())
    .then(function(data) {
    console.log(data);
    });
  });
</script>


<script>


  const buttonForm = document.getElementById("btn1");
  
  buttonForm.addEventListener("click",(event) => {
    event.preventDefault();
    configureNetwork();

     });
  
 
     const buttonForm2 = document.getElementById("btn2");
  
     buttonForm2.addEventListener("click",(event) => {
       event.preventDefault();
       startNetwork();
        });
     


        function AddRows(network) {
          var table = document.getElementById("myTable").getElementsByTagName('tbody')[0];
          var row = table.insertRow(0);
          row.id = `network-${network}`;
          var cel0=row.insertCell(0);
          cel0.innerHTML = `<a role="button" onclick="view('${network}')"  >
            <span id="icon" class="iconify-inline icon "><i class="mdi mdi-chevron-right mdi-24px"></i></span>
          </a>`;
          var cel= row.insertCell(1);
          cel.innerHTML=`  <i id="icon${network}" class="cf cf-eth"></i>`;
          changeicon(network,`icon${network}`);
          var cell1 = row.insertCell(2);
          cell1.innerHTML=network;
          var cell2 = row.insertCell(3);
          cell2.innerHTML="Configured";
          var cel3= row.insertCell(4);
          cel3.className="is-actions-cell";
          cel3.innerHTML=` 
          <div class="buttons is-center">
          <button id="viewgraph${network}" onclick="view()" class="button is-small is-primary" type="button">
            <span class="icon"><i class="mdi mdi-eye"></i></span>
          </button>
          <button id="startstop${network}" onclick="startNetwork('${network}')" class="button is-small is-success jb-modal" data-target="sample-modal" type="button">
            <span class="icon"><i id="stopstopicon${network}" class="mdi mdi-arrow-right-drop-circle"></i></span>
          </button>
          <button  id="clean${network}" class="button is-small is-danger jb-modal appear" data-target="sample-modal" type="button">
            <span class="icon"><i  class="mdi mdi-close-box"></i></span>
          </button>
        </div>`; 
        var cel4= row.insertCell(5);
        cel4.innerHTML=`<button   class="button k-button is-primary is-small is-semibold" type="button">
          Traffic Generation
        </button>`;
          
        };

        function startNetwork(){
          var value = event.value;
          var num_of_nodes=document.getElementById('num_of_nodes2').value;
          console.log(network);
          let url = `/request/${network}/start/${num_of_nodes}`;
          $("#wait2").toggleClass('hidden appear');
          toggles(network);
          fetch(url, {
          method: "POST",
          })
          .then(data => {
            console.log("ok")
            $("#wait2").toggleClass('appear hidden');

            if (!data.ok) {
              throw new Error("HTTP error " + data.status);
          }
            return data.json()})
          .then((response) => {
            console.log(response);
            })
          .catch((err) => console.error(err));

        };

        function configureNetwork(){
          network  = document.getElementById('selected').value;
          if (network ==="Select a Network"){
            alert("Please select a valid network!");
          }
          var num_of_nodes=document.getElementById('num_of_nodes').value;
          let url = `/request/${network}/configure/${num_of_nodes}`;
          $("#wait1").toggleClass('hidden appear');
      
          fetch(url, {
          method: "POST",
          })
          .then(data => {
            console.log("ok")
      
            if (!data.ok) {
              throw new Error("HTTP error " + data.status);
          }
            return data.json()})
          .then((response) => {
           console.log(response);
           $("#wait1").toggleClass('appear hidden');
           $("#to-step-2").toggleClass('hidden appear');
           $("#array").toggleClass('hidden appear');
           AddRows(network);
           changeicon(network,"icon1");
           changeicon(network,`icon${network}`);
           })
          .catch((err) => console.error(err));
        };

        function changeicon(network, icon){
          if (network==="xrpl"){
            document.getElementById(icon).className="cf cf-xrp";
          };
          if (network==="stellar-docker-testnet"){
            document.getElementById(icon).className="cf cf-xlm";
          };
          if (network==="besu-poa"){
            document.getElementById(icon).className="cf cf-xyo";
          };
          if (network==="geth"){
            document.getElementById(icon).className="cf cf-eth";
          };
        };

</script>

<link rel="stylesheet" href="https://cdn.materialdesignicons.com/4.9.95/css/materialdesignicons.min.css">
{%endblock%}